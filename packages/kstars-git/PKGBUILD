# Maintainer: Mattia Procopio (astro.matto) <matto.astro at gmail dot com>
pkgname=kstars-git
pkgver=r188.1b017c2
pkgrel=1
pkgdesc="Kstars planetary software and ekos"
arch=(x86_64 aarch64)
provides=(kstars)
conflicts=(kstars)
url="https://edu.kde.org/kstars/"
license=(GPL-2.0-or-later
         LGPL-2.1-or-later)
depends=(breeze-icons
         cfitsio
         gcc-libs
         glibc
         gsl
         hicolor-icon-theme
         kconfig
         kconfigwidgets
         kcoreaddons
         kcrash
         ki18n
         kio
         knotifyconfig
         knewstuff
         kplotting
         kwidgetsaddons
         kxmlgui
         libindi-git
         libnova
         libraw
         libxisf
         opencv
         qt6-base
         qt6-datavis3d
         qt6-declarative
         qt6-svg
         qt6-websockets
         qtkeychain-qt6
	 stellarsolver
         xplanet
         zlib)
makedepends=(cmake
             eigen
             extra-cmake-modules
             kdoctools)
source=("kstars::https://github.com/KDE/kstars/archive/refs/heads/master.zip")
sha256sums=(SKIP)

pkgver() {
  cd kstars-master
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short=7 HEAD)"
}

build() {
  cmake -B build -S kstars-master \
	-DCMAKE_INSTALL_PREFIX=/usr \
        -DBUILD_TESTING=OFF \
        -DBUILD_QT5=OFF \
        -DCMAKE_C_FLAGS="$CFLAGS -ffat-lto-objects" \
        -DCMAKE_CXX_FLAGS="$CXXFLAGS -ffat-lto-objects"
  cmake --build build
}

package() {
  DESTDIR="$pkgdir" cmake --install build
}
