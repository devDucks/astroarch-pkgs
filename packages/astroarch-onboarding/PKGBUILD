# Maintainer: Mattia Procopio (astro.matto) <matto.astro at gmail dot com>
pkgname=astroarch-onboarding
pkgver=1.2.3
pkgrel=2
pkgdesc='AstroArch onboarding'
arch=(aarch64)
url="https://github.com/devDucks/astroarch-onboarding"
license=('BSD-2-Clause'
	'CC-BY-4.0'
	'CC0-1.0'
	'GPL-3.0-or-later'
	'LGPL-2.1-only'
	'LGPL-3.0-or-later'
	'MIT')
depends=('ckbcomp'
	'perl-xml-parser'
	'perl-xml-writer'
	'sysfsutils'
	'setconf'
	'cmake'
	'yaml-cpp')
makedepends=('extra-cmake-modules' 'git')
source=("https://github.com/sc74/astroarch-onboarding/archive/refs/tags/v${pkgver}.tar.gz")
sha256sums=('2c74d154549b375eae0022fe23d6ec44fc0b7347ec00a3cbabb57116e6d6bfe1')

build() {
	cd "${srcdir}/${pkgname}-${pkgver}"
	mkdir -p build
	cd build
	cmake -DCMAKE_BUILD_TYPE=release -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR=lib -DWITH_QT6=ON -DINSTALL_CONFIG=ON ..
	make -j$(nproc)
}

package() {
	cd "${srcdir}/${pkgname}-${pkgver}/build"
	make DESTDIR="$pkgdir" install
	mkdir -p "$pkgdir/etc/polkit-1/rules.d/"
	cp -Rf "${srcdir}/${pkgname}-${pkgver}/src/branding/astroarch" "$pkgdir/usr/share/calamares/branding/"
	cp -Rf "${srcdir}/${pkgname}-${pkgver}/src/usr/share/astroarch_onboarding" "$pkgdir/usr/share/"
	rm -f "$pkgdir/usr/share/polkit-1/actions/com.github.calamares.calamares.policy"
	cp -f "${srcdir}/${pkgname}-${pkgver}/src/usr/share/astroarch_onboarding/configs/com.github.calamares.calamares.policy" "$pkgdir/usr/share/polkit-1/actions/com.github.calamares.calamares.policy"
	cp -f "${srcdir}/${pkgname}-${pkgver}/src/usr/share/astroarch_onboarding/configs/49-nopasswd-calamares-vnc.rules" "$pkgdir/etc/polkit-1/rules.d/49-nopasswd-calamares-vnc.rules"
	cp -f "${srcdir}/${pkgname}-${pkgver}/src/usr/share/astroarch_onboarding/configs/49-nopasswd-calamares-xrdp.rules" "$pkgdir/etc/polkit-1/rules.d/49-nopasswd-calamares-xrdp.rules"
}
