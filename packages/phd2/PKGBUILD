# Maintainer: Mattia Procopio (astro.matto) <matto.astro at gmail dot com>
pkgname=phd2
pkgver=2.6.14
pkgrel=2
pkgdesc="OpenPHDGuiding"
arch=(x86_64 aarch64)
url="https://openphdguiding.org/"
license=('LGPL')
depends=(cfitsio
         curl
         hdf5
         libnova
         libtiff5
         vtk
         wxwidgets-common	 
         wxwidgets-gtk3)
makedepends=(cmake eigen)
source=("https://github.com/OpenPHDGuiding/phd2/archive/refs/tags/v$pkgver.tar.gz")
sha256sums=('e5fdf91c9ba85589de0e3801af1c51a09b619fe7a10a2e46a5e9e3fb315cf336')

prepare() {
  mkdir -p build
  cd build
  cmake -DCMAKE_POLICY_VERSION_MINIMUM=3.5 \
        -DUSE_SYSTEM_LIBINDI=ON \
        -DCMAKE_C_COMPILER_LAUNCHER=distcc \
        -DCMAKE_CXX_COMPILER_LAUNCHER=distcc \
        -DUSE_SYSTEM_LIBUSB=ON \
        -DUSE_SYSTEM_GTEST=ON \
        -DEIGEN_SRC=/usr/include/eigen3 \
        ../phd2-$pkgver
}

build() {
  cd build
  make
}

package() {
  cd build
  make DESTDIR="$pkgdir" install
}

